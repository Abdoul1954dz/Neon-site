const INSTAGRAM_USERNAME='abdelghafournaceri';const FORMSPREE='https://formspree.io/f/xldlzpgw';const USD_TO_DZD=180;const PRODUCTS=[{id:101,title:'Free Fire — 530 Diamonds',usd:5.05},{id:102,title:'Free Fire — 1080 Diamonds',usd:10.13},{id:201,title:'PUBG — 300 UC',usd:4.49},{id:202,title:'PUBG — 600 UC',usd:8.99},{id:301,title:'Call of Duty — 1000 CP',usd:9.99},{id:401,title:'Roblox — 1000 Robux',usd:9.99},{id:501,title:'FIFA Points — 1050',usd:9.99},{id:601,title:'Steam Wallet $10',usd:10.00}];let cart=JSON.parse(localStorage.getItem('neon_cart_v1')||'[]');function usdToDzd(u){return Math.round(u*USD_TO_DZD);}function formatDZD(n){return n.toLocaleString('en-US')+' DZD'}function saveCart(){localStorage.setItem('neon_cart_v1',JSON.stringify(cart));renderCart()}function addToCart(id){const p=PRODUCTS.find(x=>x.id===id);if(!p)return alert('منتج غير موجود');const f=cart.find(c=>c.id===id);if(f)f.qty++;else cart.push({id:id,qty:1});saveCart();toast('أضيف إلى السلة')}function removeFromCart(i){cart.splice(i,1);saveCart();toast('حذف')}function clearCart(){if(!confirm('تفريغ السلة؟'))return;cart=[];saveCart();toast('تم تفريغ السلة')}function calculate(){let totalUSD=0,sumDZD=0;cart.forEach(c=>{const p=PRODUCTS.find(x=>x.id===c.id);totalUSD+=p.usd*c.qty;sumDZD+=usdToDzd(p.usd)*c.qty});let commission=0;if(totalUSD>5)commission=20;let final=sumDZD+commission;return{totalUSD:Number(totalUSD.toFixed(2)),sumDZD,commission,final}}function renderCart(){const container=document.getElementById('cart-items');const cartCount=document.getElementById('cart-count');if(!container)return;container.innerHTML='';if(cart.length===0){container.innerHTML='<div class="note">السلة فارغة</div>';document.getElementById('cart-total').innerText=formatDZD(0);if(cartCount)cartCount.innerText='0';return}cart.forEach((c,i)=>{const p=PRODUCTS.find(x=>x.id===c.id);const row=document.createElement('div');row.className='cart-item';row.innerHTML=`<div><strong>${p.title}</strong><div class="note">${p.usd} USD × ${c.qty}</div></div><div><button class="btn ghost" onclick="removeFromCart(${i})">حذف</button></div>`;container.appendChild(row)});const totals=calculate();document.getElementById('cart-total').innerText=formatDZD(totals.sumDZD);const com=document.getElementById('commission-note');if(com){com.innerText=totals.commission===0? 'العمولة: مجانية من صاحب الموقع' : 'العمولة: '+formatDZD(totals.commission)}if(cartCount)cartCount.innerText=cart.reduce((s,x)=>s+x.qty,0)}function prepareOrderText(name,phone,email,preferred,note){let lines=[];let totalUSD=0;cart.forEach(c=>{const p=PRODUCTS.find(x=>x.id===c.id);lines.push(`${p.title} × ${c.qty} — ${p.usd} USD`);totalUSD+=p.usd*c.qty});const t=calculate();const body=`طلب من Neon Shop\n\n${lines.join('\n')}\n\nالمجموع (USD): ${t.totalUSD} USD\nالمجموع (DZD): ${t.sumDZD} DZD\nالعمولة: ${t.commission} DZD\nالإجمالي المستحق: ${t.final} DZD\n\nطريقة الدفع: ${preferred}\nالاسم: ${name}\nالهاتف: ${phone}\nالبريد: ${email}\nملاحظات: ${note}`;return{body,t}}async function submitOrder(name,email,phone,preferred,note){const prepared=prepareOrderText(name,phone,email,preferred,note);try{const payload={name,email,phone,preferred,note,order:prepared.body};const res=await fetch(FORMSPREE,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(res.ok){toast('تم إرسال الطلب إلى بريدك');try{await navigator.clipboard.writeText(prepared.body)}catch(e){}window.open('https://instagram.com/'+INSTAGRAM_USERNAME,'_blank');localStorage.removeItem('neon_cart_v1');cart=[];renderCart();return true}else{toast('خطأ أثناء إرسال الطلب');return false}}catch(e){toast('مشكلة في الإرسال');return false}}function toast(t){const e=document.createElement('div');e.style.position='fixed';e.style.left='50%';e.style.transform='translateX(-50%)';e.style.bottom='70px';e.style.background='rgba(15,23,42,0.88)';e.style.color='white';e.style.padding='8px 12px';e.style.borderRadius='8px';e.innerText=t;document.body.appendChild(e);setTimeout(()=>e.remove(),1600)}window.addToCart=addToCart;window.removeFromCart=removeFromCart;window.clearCart=clearCart;document.addEventListener('DOMContentLoaded',()=>{renderCart()});